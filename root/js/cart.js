$(document).ready(function(){function getSubTotal(row){var price=parseFloat($(row).find(".selling-price").data("bind"));var qty=parseInt($(row).find(":text").val());var result=price*qty;$(row).find(".selling-price").text($.formatMoney(price,2));$(row).find(".subtotal").text($.formatMoney(result,2)).data("bind",result.toFixed(2))};function getTotal(){var qtyTotal=0;var itemCount=0;var priceTotal=0;$(cartTable).find("tr:gt(0)").each(function(){getSubTotal(this);if($(this).find(":checkbox").prop("checked")==true){itemCount++;qtyTotal+=parseInt($(this).find(":text").val());priceTotal+=parseFloat($(this).find(".subtotal").data("bind"))}});$("#itemCount").text(itemCount).data("bind",itemCount);$("#qtyCount").text(qtyTotal).data("bind",qtyTotal);$("#priceTotal").text($.formatMoney(priceTotal,2)).data("bind",priceTotal.toFixed(2))};var cartTable=$("#cartTable");getTotal();$(cartTable).find(":checkbox").click(function(){if($(this).hasClass("check-all")){var checked=$(this).prop("checked");$(cartTable).find(".check-one").prop("checked",checked)}var items=cartTable.find("tr:gt(0)");$(cartTable).find(".check-all").prop("checked",items.find(":checkbox:checked").length==items.length);$("#btn_settlement").attr("disabled",items.find(":checkbox:checked").length==0);getTotal()});$(cartTable).find("tr:gt(0)").each(function(){var input=$(this).find(":text");$(input).keyup(function(){var val=parseInt($(this).val());if(isNaN(val)||(val<1)){$(this).val("1")}getSubTotal($(this).parent().parent());getTotal()});$(this).click(function(){var val=parseInt($(input).val());if(isNaN(val)||(val<1)){val=1}if($(window.event.srcElement).hasClass("minus")){$sid=$(input).data('sid');$.ajax({type:"POST",dataType:"html",url:'/index.php/shopping/minusAmount',data:'sid='+$sid,success:function(data){sn=parseInt(data);if(isNaN(sn)){alert("修改数量失败！"+data)}else{$(input).val(val-1);getTotal()}},error:function(data){alert("修改数量失败~"+data.responseText)}})}else if($(window.event.srcElement).hasClass("plus")){$sid=$(input).data('sid');$.ajax({type:"POST",dataType:"html",url:'/index.php/shopping/addAmount',data:'sid='+$sid,success:function(data){sn=parseInt(data);if(isNaN(sn)){alert("修改数量失败！"+data)}else{$(input).val(val+1);getTotal()}},error:function(data){alert("修改数量失败~"+data.responseText)}})}})})});